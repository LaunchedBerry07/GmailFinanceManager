
### Project Directive: "DataBerry" - Phase 10: Cross-Platform Synergy - Google Drive PDF Export

Attention Replit AI Agent:

We have identified a critical gap in our operational capabilities that we must now address. Our next objective is to architect the final, crucial link between our "DataBerry" platform and the user's Google Workspace ecosystem. This phase focuses on implementing the workflow to convert selected emails and their attachments into a standardized PDF format and archive them directly within the user's Google Drive. This is a cornerstone feature for the Accounting TechnicianÂ persona, providing immutable, easily shareable records for compliance and record-keeping.

I. Strategic Objective

Your directive is to implement the end-to-end functionality that allows a user to trigger a PDF conversion and Google Drive upload for any given financial email. This will involve a seamless, behind-the-scenes orchestration between our Next.js application and the designated Google Apps Script responsible for the heavy lifting of file manipulation.

II. Technical Specifications

You are to implement the following integrated system:

1. UI Trigger:

- In the main emails data table (app/emails/page.tsx), add a new "Actions" column.
- Within this column for each row, include a distinct "Save to Drive" icon-button.

2. Orchestration API Endpoint (app/api/export/drive/route.ts):

- Create a new API route that will be called when the "Save to Drive" button is clicked. This route will receive the messageId of the selected email.
- This API endpoint will act as the orchestrator. Its primary responsibility is to securely call the Google Apps Script web app URL (which will be provided as an environment variable, APPS_SCRIPT_WEB_APP_URL).
- It will pass the messageId and the user's authentication credentials to the Apps Script.
- Upon receiving a successful response from the Apps Script (containing the new Google Drive file URL), this endpoint will update the corresponding record in our attachments table, populating the driveUrl field.

3. UI Feedback Loop:

- Once the API call is complete, the "Save to Drive" button in the UI should be replaced with a new, distinct "View in Drive" icon-button.
- This new button will be a direct link (<a> tag) that opens the newly created PDF in Google Drive in a new tab. This provides immediate, tangible feedback to the user that the operation was successful.

III. "Checkpoint-Aware" Protocol

As this feature involves a critical cross-platform integration, our disciplined protocol is more important than ever:

1. Present Your Integrated Workflow Blueprint: Before implementation, you must provide a detailed blueprint. This document needs to outline the exact payload the Next.js API will send to the Google Apps Script, the expected response format, and the UI state changes (from the initial button to the final link).
2. Await Cross-Platform Synergy Approval: I will perform a meticulous review of this workflow to ensure the integration points are secure, efficient, and robust. No development on this critical path will begin until the plan is formally approved.
